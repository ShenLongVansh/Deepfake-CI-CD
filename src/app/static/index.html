<!DOCTYPE html>
<html>
<head>
  <title>VoiceGuardAI Demo</title>

  <style>
    body {
      font-family: system-ui, sans-serif;
      max-width: 650px;
      margin: 40px auto;
      padding: 10px;
    }

    h2 {
      text-align: center;
    }

    input, button {
      padding: 8px;
      margin-top: 6px;
    }

    button {
      cursor: pointer;
    }

    .section {
      margin-top: 20px;
    }

    .result-box {
      margin-top: 20px;
      padding: 15px;
      border-radius: 6px;
      text-align: center;
      font-size: 18px;
      display: none;
    }

    .real {
      background: #e7f8ee;
      color: #1b7a3d;
      border: 1px solid #1b7a3d;
    }

    .fake {
      background: #fdecec;
      color: #b32020;
      border: 1px solid #b32020;
    }

    .confidence {
      font-size: 14px;
      margin-top: 6px;
    }

    .json-box {
      margin-top: 15px;
      background: #f6f6f6;
      padding: 10px;
      border-radius: 6px;
      font-size: 13px;
      display: none;
      white-space: pre-wrap;
    }

    #loader {
      display: none;
      margin-top: 15px;
      text-align: center;
      font-weight: bold;
    }

    .reset-btn {
      margin-top: 10px;
      background: #eee;
      border: 1px solid #aaa;
    }
  </style>
</head>

<body>

  <h2>VoiceGuardAI – Deepfake Detection</h2>

  <!-- URL input -->
  <div class="section">
    <input id="url" placeholder="Paste image URL" style="width:100%;" />
    <button onclick="predictUrl()">Predict URL</button>
  </div>

  <!-- File input -->
  <div class="section">
    <input type="file" id="file" />
    <button onclick="predictFile()">Upload & Predict</button>
    <button class="reset-btn" onclick="resetAll()">Remove Image</button>
  </div>

  <!-- Loader -->
  <div id="loader">Analyzing image… ⏳</div>

  <!-- Verdict -->
  <div id="resultBox" class="result-box">
    <div id="verdict"></div>
    <div id="confidence" class="confidence"></div>
  </div>

  <!-- Raw JSON -->
  <div id="jsonBox" class="json-box"></div>

  <script>
    function showLoader() {
      document.getElementById("loader").style.display = "block";
    }

    function hideLoader() {
      document.getElementById("loader").style.display = "none";
    }

    function showResult(data) {
      const box = document.getElementById("resultBox");
      const verdict = document.getElementById("verdict");
      const confidence = document.getElementById("confidence");
      const jsonBox = document.getElementById("jsonBox");

      const label = data.label.toLowerCase();

      box.className = "result-box " + (label === "real" ? "real" : "fake");
      verdict.innerText = label.toUpperCase();
      confidence.innerText = `Confidence: ${(data.confidence * 100).toFixed(1)}%`;

      jsonBox.innerText = JSON.stringify(data, null, 2);

      box.style.display = "block";
      jsonBox.style.display = "block";
    }

    function resetAll() {
      document.getElementById("file").value = "";
      document.getElementById("url").value = "";
      document.getElementById("resultBox").style.display = "none";
      document.getElementById("jsonBox").style.display = "none";
    }

    async function predictUrl() {
      const url = document.getElementById("url").value;
      if (!url) return alert("Please enter an image URL");

      showLoader();

      try {
        const res = await fetch("/predict", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ image_url: url })
        });

        const data = await res.json();
        showResult(data);

      } catch {
        alert("Prediction failed");
      } finally {
        hideLoader();
      }
    }

    async function predictFile() {
      const fileInput = document.getElementById("file");
      if (!fileInput.files.length) return alert("Select a file");

      const fd = new FormData();
      fd.append("file", fileInput.files[0]);

      showLoader();

      try {
        const res = await fetch("/predict-file", {
          method: "POST",
          body: fd
        });

        const data = await res.json();
        showResult(data);

      } catch {
        alert("Prediction failed");
      } finally {
        hideLoader();
      }
    }
  </script>

</body>
</html>
